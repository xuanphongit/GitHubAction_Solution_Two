name: "Replace web.config variables"
description: "Replace variables in web.config using environment and Key Vault secrets file"
inputs:
  environment:
    description: "Environment name (e.g. smoke, staging, production)"
    required: true
  keyvault-name:
    description: "Azure Key Vault name"
    required: true
  file-path:
    description: "Path to the web.config file"
    required: true
  secrets-env-path:
    description: "Path to the secrets.env file (default: ./secrets.env)"
    required: false
    default: "./secrets.env"
  replace-script-path:
    description: "Path to replace.sh script"
    required: false
    default: "./replace.sh"
  use-keyvault:
    description: "Flag to determine if Key Vault should be used"
    required: false
    default: "true"

runs:
  using: "composite"
  steps:
    - name: Replace variables in web.config
      if: ${{ inputs.use-keyvault == 'true' || inputs.use-keyvault == 'false' }}
      shell: bash
      run: |
        chmod +x "${{ inputs.replace-script-path }}"
        "${{ inputs.replace-script-path }}" \
          "${{ inputs.environment }}" \
          "${{ inputs.keyvault-name }}" \
          "${{ inputs.file-path }}" \
          "${{ inputs.secrets-env-path }}"
